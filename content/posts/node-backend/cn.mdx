---
title: "Node.js后端"
author: "onichandame"
date: 2019-06-02
---

本文记录我在开发基于Node.js的后端服务过程中遇到的问题。

# POST

通用的处理POST请求的库有2个：Formidable和Body-Parser.

## Formidable

这个库可以处理field values和files。但用的人较少。

## Body Parser

这个库只能处理field values。它支持2种数据结构：url encoded和json。

```typescript
import bodyParser from 'body-parser'
```

### URL Encoded

```typescript
server.use(bodyParser.urlencoded({ extended: true }))
```

### JSON

客户端必须将header `Content-Type`设成`application/json`，否则Body Parser无法理解请求。

```typescript
server.use(bodyParser.json())
```

# 授权管理

大致上有2种提供授权管理服务的方法，它们有一些共通的特性。

# 共通特性

无论选择哪一种方法，以下特性都必须存在：

1. 用户注册、登录、登出和登录状态
2. 用户管理，如邀请、伪装、删除用户、添加用户、重置用户等
3. 存储用户信息和session token的的永久存储池

# 自持

在小规模且子系统间互相独立的系统中，授权管理可由各子系统独立运作。

这种方法的常用技术栈是：

- MongoDB
- Passport.js
- Express.js

# 中心化

在子系统深度耦合时，需要有一个中心化的授权管理服务。
